<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simple Calculator</title>
    <link rel="stylesheet" href="assets/css/calculator.style.css" />
  </head>

  <body>
    <header>
      <button class="close" onclick="window.location.href='index.html'">
        &#10006;
      </button>
      <p>Simple Calculator</p>
      <p>Try it!</p>
    </header>
    <main>
      <div class="container">
        <div class="display-result">
          <p class="operation">
            <span id="fn"></span>
            <span id="op"></span>
            <span id="sn"></span>
            <span id="eql"></span>
          </p>
          <p id="result">0</p>
        </div>
        <hr />
        <div class="field">
          <div class="button">7</div>
          <div class="button">8</div>
          <div class="button">9</div>
          <div class="button del">DEL</div>
        </div>
        <div class="field">
          <div class="button">4</div>
          <div class="button">5</div>
          <div class="button">6</div>
          <div class="button operator">-</div>
        </div>
        <div class="field">
          <div class="button">1</div>
          <div class="button">2</div>
          <div class="button">3</div>
          <div class="button operator">+</div>
        </div>
        <div class="field">
          <div class="button clear">CE</div>
          <div class="button">0</div>
          <div class="button negative">+/-</div>
          <div class="button equals">=</div>
        </div>
      </div>
    </main>
    <footer>
      <p>Belajar Dasar Pemrograman Web &#169; 2019</p>
      <p>Simple Calculator | Dicoding Academy</p>
    </footer>

    <!-- <script src="assets/js/calculator.scripts.js"></script> -->
    <script>
      // set tampilan
      // create object
      const calculator = {
        result: "0", //angka yang muncul pada result
        operator: null, //operator yang dipilih
        firstNumber: null, //angka pertama yang diinputkan
        secondNumber: null,
        waitingForSecondNumber: false, //logika untuk menunggu input angka yang kedua
        waitingForOperation: false,
      };

      // create function

      // mengupdate nilai pada result
      function updateDisplay() {
        document.querySelector("#result").innerText = calculator.result;
      }

      function updateDisplayOperation() {
        if (calculator.waitingForOperation === true) {
          document.querySelector("#sn").innerText = calculator.secondNumber;
          document.querySelector("#eql").innerText = "=";
        } else {
          document.querySelector("#fn").innerText = calculator.firstNumber;
          document.querySelector("#op").innerText = calculator.operator;
        }
      }

      function removeDisplayOperation() {
        document.getElementById("fn").innerHTML = "";
        document.getElementById("sn").innerHTML = "";
        document.getElementById("op").innerHTML = "";
        document.getElementById("eql").innerHTML = "";
      }

      // mengset calculator ke awal/clear
      function clearCalc() {
        calculator.result = "0";
        calculator.operator = null;
        calculator.firstNumber = null;
        calculator.secondNumber = null;
        (calculator.waitingForSecondNumber = false),
          (calculator.waitingForOperation = false);

        removeDisplayOperation();
      }

      // memasukkan angka ke dalam nilai calculator.displayNumber
      function inputDigit(digit) {
        if (calculator.waitingForOperation === true) {
          clearCalc();
        }

        if (calculator.waitingForSecondNumber === true) {
          if (
            calculator.secondNumber === null ||
            calculator.secondNumber === "0"
          ) {
            calculator.secondNumber = digit;
          } else if (calculator.secondNumber.length == 16) {
            return;
          } else {
            calculator.secondNumber += digit;
          }

          calculator.result = calculator.secondNumber;
        } else {
          if (calculator.result === "0") {
            calculator.result = digit;
          } else if (calculator.result.length == 16) {
            return;
          } else {
            calculator.result += digit;
          }
        }
      }

      // klik button negative
      function inverseNumber() {
        if (calculator.result === "0") {
          return;
        } else if (calculator.waitingForSecondNumber === false) {
          calculator.result = calculator.result * -1;
        } else {
          calculator.secondNumber = calculator.secondNumber * -1;
          calculator.result = calculator.secondNumber;
        }
      }

      // klik button operator
      function handleOperator(operator) {
        if (!calculator.waitingForSecondNumber) {
          calculator.operator = operator;
          calculator.waitingForSecondNumber = true;
          calculator.firstNumber = calculator.result;

          // mengatur nilai secondNumber
          // calculator.secondNumber = '0';
        } else {
          alert("operator sudah ditetapkan");
        }
      }

      // melakukan kalkukalasi
      function performCalc() {
        // calculator.waitingForSecondNumber = false;

        if (calculator.firstNumber == null || calculator.operator == null) {
          alert("Anda belum menetapkan operator");

          return;
        } else if (
          calculator.secondNumber == null &&
          calculator.operator !== null
        ) {
          calculator.secondNumber = calculator.firstNumber;
        }

        let results = 0;
        // let temp = '0';
        if (calculator.operator === "+") {
          results =
            parseInt(calculator.firstNumber) + parseInt(calculator.result);
        } else {
          results =
            parseInt(calculator.firstNumber) - parseInt(calculator.result);
        }

        calculator.result = results.toString();
        calculator.waitingForOperation = true;

        // if (calculator.waitingForSecondNumber === true) {
        // 	if (calculator.operator === "+") {
        // 		results = parseInt(calculator.firstNumber) + parseInt(calculator.result);
        // 	} else {
        // 		results = parseInt(calculator.firstNumber) - parseInt(calculator.result);
        // 	}

        // 	temp = calculator.result;
        // 	calculator.waitingForSecondNumber = false;
        // } else {
        // 	if (calculator.operator === "+") {
        // 		results = parseInt(calculator.firstNumber) + parseInt(temp);
        // 	} else {
        // 		results = parseInt(calculator.firstNumber) - parseInt(temp);
        // 	}
        // }

        // calculator.firstNumber = results.toString();
        // calculator.result = results.toString();
      }

      // melakukan delete
      function delNumber() {
        if (calculator.result.length == 1) {
          calculator.result = "0";
        } else {
          // calculator.result = calculator.result.substring(0, calculator.result.length-1);
          calculator.result = calculator.result.slice(0, -1);
        }
      }

      const buttons = document.querySelectorAll(".button");
      // event handler button
      for (let button of buttons) {
        // input angka
        button.addEventListener("click", function (event) {
          // mendapat objek elemen yang di klik
          const target = event.target;

          if (target.classList.contains("clear")) {
            clearCalc();
            updateDisplay();

            return;
          }

          if (target.classList.contains("negative")) {
            inverseNumber();
            updateDisplay();

            return;
          }

          if (target.classList.contains("equals")) {
            performCalc();
            updateDisplayOperation();
            updateDisplay();

            return;
          }

          if (target.classList.contains("operator")) {
            handleOperator(target.innerText);
            updateDisplayOperation();

            return;
          }

          if (target.classList.contains("del")) {
            delNumber();
            updateDisplay();

            return;
          }

          // button tap
          inputDigit(target.innerText);
          updateDisplay();
        });
      }
    </script>
  </body>
</html>
